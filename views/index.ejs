<!DOCTYPE html>
<html>

<%- include('head'); %>

<body>
  <%- include('navbar', { user: user }); %>
  <%- include('top-filters'); %>


  <div class="row mt-5 px-sm-5 px-4 w-100 m-0">

    <div class="col-md-3 col-12">
      <%- include('side-filters'); %>
    </div>

    <div class="col-md-9 col-12 d-flex flex-column align-items-center">

      <div class="row row-cols-1 row-cols-md-3" style="flex: 0 0 auto;">
        <% products.forEach(function(product){ %>
        <div class="col d-flex justify-content-center mb-4 p-0">
          <%- include('product-card', {product: product}); %>
        </div>
        <% }); %>
      </div>

      <nav aria-label="Products pages">
        <ul class="pagination mb-5 mt-3" id="pagination-list">

        </ul>
      </nav>

    </div>


  </div>

  <%- include('scripts', {page: 'index'}); %>


  <script>
    const ul = document.getElementById('pagination-list')
    const pageNum = parseInt(getParam('page'));

    let paginationItems = ''
    let prev = pageNum === 1 ? null : pageNum - 1;
    let next = pageNum + 1;

    for (let i = prev ? prev : pageNum; i <= next; i++) {
      paginationItems += `<li class="page-item" id="${i}"><a class="page-link" href="/?page=${i}">${i}</a></li>`
    }

    ul.innerHTML = `${prev ? `<li class="page-item"><a class="page-link" href="/?page=${prev}">Previous</a></li>` : `<li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>`}
           ${paginationItems}
    <li class="page-item"><a class="page-link" href="/?page=${next}">Next</a></li>`

    document.getElementById(pageNum).classList.add('active')

    function getParam(paramName) {
      return decodeURIComponent(
        location.search
          .substr(1)
          .split('&')
          .reduce(
            (a, elem) =>
              elem.split('=')[0] === paramName ? a + elem.split('=')[1] : a,
            ''
          )
      );
    }
  </script>

</body>

</html>