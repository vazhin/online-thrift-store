<div class="row mb-lg-0 mb-5">


  <div class="col-md-12 col-sm-6 col-12 d-flex flex-column">
    <form method="GET" action="/search" class="form-inline">
      <input class="form-control mr-sm-2" type="search" placeholder="Search Products" aria-label="Search" name="q"
        id="searchInput">

      <div class="btn-group my-2 my-xl-0 font-poppins">
        <button type="button" class="btn btn-outline-primary font-poppins dropdown-toggle" data-toggle="dropdown"
          aria-haspopup="true" aria-expanded="false">
          Search
        </button>
        <div class="dropdown-menu">
          <button class="dropdown-item" type="submit">Names</button>
          <button class="dropdown-item" type="button" onclick="searchForLocation()">Locations</button>
        </div>
      </div>

      <!-- <button class="btn btn-outline-primary font-poppins my-2 my-sm-0" type="submit">Search</button> -->
    </form>
  </div>


  <div class="col-md-12 col-sm-6 col-12 d-flex flex-wrap my-md-4 my-sm-0 my-4 align-items-center"
    id="applied-filters-container">
    <h6 class="m-0 text-primary">Applied filtres:</h6>
  </div>


  <div class="col-md-12 col-sm-6 col-12 d-flex flex-column my-md-4 my-sm-0 my-4">
    <h5 class="font-poppins m-0 text-dark">Categories</h5>
    <div class="d-flex flex-column font-open-sans">
      <div class="d-flex align-items-center mt-2">
        <p onclick="filterByCategory(this.id)" id="clothes" class="text-dark m-0 filters">
          Clothes
        </p>
        <span class="badge badge-light text-primary font-poppins ml-2"><%= count.clothes %> </span>
      </div>

      <div class="d-flex align-items-center mt-2">
        <p onclick="filterByCategory(this.id)" id="computer" class="text-dark m-0 filters">
          Computers
        </p>
        <span class="badge badge-light text-primary font-poppins ml-2"><%= count.computer %> </span>
      </div>

      <div class="d-flex align-items-center mt-2">
        <p onclick="filterByCategory(this.id)" id="furniture" class="text-dark m-0 filters">
          Furniture
        </p>
        <span class="badge badge-light text-primary font-poppins ml-2"><%= count.furniture %> </span>
      </div>

      <div class="d-flex align-items-center mt-2">
        <p onclick="filterByCategory(this.id)" id="mobile-device" class="text-dark m-0 filters">Mobile
          Phones
        </p>
        <span class="badge badge-light text-primary font-poppins ml-2"><%= count['mobile device'] %> </span>
      </div>

    </div>
  </div>


  <div class="col-md-12 col-sm-6 col-12 d-flex flex-column my-md-4 my-sm-0 my-4">
    <h5 class="font-poppins m-0 text-dark">Condition</h5>

    <form id="conditionForm" class="d-flex flex-column font-open-sans">

      <div class="custom-control custom-checkbox mt-2">
        <input type="checkbox" class="custom-control-input" id="like-new" name="condition" value="like-new">
        <label class="custom-control-label filters" for="like-new">Like-new</label>
      </div>

      <div class="custom-control custom-checkbox mt-2">
        <input type="checkbox" class="custom-control-input" id="new-with-tags" name="condition" value="new with tags">
        <label class="custom-control-label filters" for="new-with-tags">New with tags</label>
      </div>

      <div class="custom-control custom-checkbox mt-2">
        <input type="checkbox" class="custom-control-input" id="gently-used" name="condition" value="gently-used">
        <label class="custom-control-label filters" for="gently-used">Gently-used</label>
      </div>

      <div class="custom-control custom-checkbox mt-2">
        <input type="checkbox" class="custom-control-input" id="signs-of-use" name="condition" value="signs of use">
        <label class="custom-control-label filters" for="signs-of-use">Signs of use</label>
      </div>

      <div class="d-flex mt-4 font-poppins">
        <input class="btn btn-primary" type="submit" value="Apply">
        <input class="btn btn-secondary ml-3" type="reset" value="Reset">
      </div>

    </form>

  </div>
</div>

<script>
  const conditionForm = document.getElementById('conditionForm')

  conditionForm.addEventListener('submit', (e) => {
    e.preventDefault()
    const form = e.target
    const formData = new FormData(form)

    const searchParams = new URLSearchParams(location.search)
    searchParams.delete('condition')
    searchParams.delete('page')

    for (let pair of formData.entries()) {
      searchParams.append(pair[0], pair[1])
    }
    location.replace(`/?${searchParams.toString()}`)
  })

  conditionForm.addEventListener('reset', () => {
    location.href = '/'
  })
  function searchForLocation() {
    const query = document.getElementById('searchInput').value
    location.href = `/search?location=${query}`
  }
  function filterByCategory(value) {
    value = value.split('-').join(' ') // because I need "mobile-device" to be "mobile device". I'm passing the value as an (id).
    const searchParams = new URLSearchParams(location.search)
    searchParams.delete('page')
    searchParams.set('category', value)
    location.replace(`/?${searchParams.toString()}`)
  }


  const appliedFiltersContainer = document.getElementById('applied-filters-container')
  const searchParams = new URLSearchParams(location.search)

  for (let pair of searchParams.entries()) {
    if (!['q', 'location', 'page'].includes(pair[0])) {
      appliedFiltersContainer.insertAdjacentHTML('beforeend', `<span class="badge badge-secondary m-1">${pair[1]}</span>`);
    }
  }

</script>